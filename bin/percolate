#!/usr/bin/env bash
# -*- mode: sh; coding: utf-8; tab-width: 4; indent-tabs-mode: nil -*-
set -euo pipefail
IFS=$'\n\t'

brew update
brew bundle --file="$HOME"/.dotfiles/Brewfile --no-lock
brew upgrade
brew cask upgrade
brew cleanup --prune=0
brew missing

python3 -m pip install -U virtualenv virtualenvwrapper

mkdir -p "$XDG_DATA_HOME"/tmux-plugins.d/tpm

if [[ -z $(ls -A "$XDG_DATA_HOME"/tmux-plugins.d/tpm) ]]
then
  (cd "$XDG_DATA_HOME"/tmux-plugins.d/tpm && git clone git@github.com:tmux-plugins/tpm.git .)
  "$XDG_DATA_HOME"/tmux-plugins.d/tpm/bin/install_plugins
else
  (cd "$XDG_DATA_HOME"/tmux-plugins.d/tpm && git pull --ff-only)
  "$XDG_DATA_HOME"/tmux-plugins.d/tpm/bin/update_plugins all
fi

exit 0
